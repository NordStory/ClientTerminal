# Система управления заказами

Этот модуль является частью комплексной системы автоматизации **SCAutomation** для сервисного центра "Гитарюга". 

## Описание системы

Система состоит из трех основных компонентов:
1. **Google Форма** - для самостоятельного оформления заявок клиентами
2. **Лист "Форма"** - для хранения всех заказов в Google Таблицах
3. **Лист "АктПриёма"** - для автоматического заполнения актов приема

## Контекст проекта

Этот модуль является частью большей системы автоматизации, которая включает:
- **Терминал самообслуживания** на ресепшене
- **Складское приложение** на AppSheet
- **Telegram-бот** для уведомлений
- **Google таблица** для СЦ Гитарюга

## Настройка

### Шаг 1: Создание Google Таблицы

1. Создайте новую Google Таблицу
2. Создайте два листа:
   - **"Форма"** - для хранения данных заказов
   - **"АктПриёма"** - для актов приема

### Шаг 2: Настройка листа "Форма"

Структура листа "Форма" (соответствует Google Форме):

| Столбец | Название поля | Описание |
|---------|---------------|----------|
| **A** | Статус | Статус заказа (Новый, В работе, Готов, Выдан) |
| **B** | Номер заказа | Автоматически генерируется скриптом |
| **C** | Отметка времени | Дата и время создания заявки |
| **D** | Заказчик ФИО | ФИО клиента |
| **E** | Номер телефона | Контактный телефон |
| **F** | Материнская плата | Модель устройства |
| **G** | Серийный номер | Серийный номер устройства |
| **H** | Комплектность (Без коробки) | Описание комплектации |
| **I** | Где можно найти Вашу историю переписки с СЦ Гитарюга | Социальная сеть/мессенджер |
| **J** | Цена | Стоимость ремонта |
| **K** | Оплачено | Статус оплаты |
| **L** | Заявленная неисправность | Описание проблемы |
| **M** | Как хотите получить Заказ? | Способ получения |

### Шаг 3: Настройка листа "АктПриёма"

Структура листа "АктПриёма":
- **B7** - Номер заказа
- **B9** - ФИО клиента (Заказчик ФИО)
- **B11** - Телефон (Номер телефона)
- **B13** - Социальная сеть (Где можно найти историю переписки)
- **B15** - Модель устройства (Материнская плата)
- **B16** - Серийный номер
- **B17:H17** - Комплектация (Комплектность)
- **B18:H18** - Заявленная проблема

> шаблон таблицы https://docs.google.com/spreadsheets/d/1-7cYIXeRBN5bEXYYPC4zl4pYBMi5y8qv9WY1KfhmI08/edit?gid=830972553#gid=830972553

### Шаг 4: Создание Google Apps Script

1. В Google Таблице выберите **Расширения** → **Apps Script**
2. Создайте новый проект
3. Скопируйте код из файлов в соответствующие файлы скрипта

### Шаг 5: Настройка ID таблицы

В файле `acceptanceСertificate.js` замените `spreadSheetID` на ID вашей таблицы:

```javascript
const SpreadsheetID = 'ВАШ_ID_ТАБЛИЦЫ_ЗДЕСЬ'
```

**Как найти ID таблицы:**
- Откройте вашу таблицу
- ID находится в URL после `/d/` и перед `/edit`
- Пример: `https://docs.google.com/spreadsheets/d/1ABC123.../edit#gid=0`
- ID: `1ABC123...`

### Шаг 6: Создание триггера

1. В Apps Script выберите **Триггеры** (значок часов)
2. Нажмите **+ Добавить триггер**
3. Настройте триггер:
   - **Выберите источник события:** Из таблицы
   - **Выберите тип события:** При отправке формы
   - **Выберите таблицу:** Ваша таблица
   - **Выберите функцию:** `generateNextOrderNumber`
4. Сохраните триггер

**Или используйте функцию `createTrigger()`:**
1. Запустите функцию `createTrigger()` один раз в Apps Script
2. Она автоматически создаст нужный триггер

## Структура файлов

### `acceptanceСertificate.js`
- Основная функция: `fillAcceptanceCertificate()`
- Заполняет акт приема данными из формы
- **ВАЖНО:** Укажите правильный `spreadSheetID`

### `generateNextOrderNumber.js`
- Генерирует следующий номер заказа
- Автоматически вызывается при отправке формы
- Заполняет номер заказа в акте приема

### `trigger.js`
- Создает триггер для автоматического запуска
- Функция: `createTrigger()`

## Как это работает

1. **Клиент заполняет форму** → данные записываются в лист "Форма"
2. **Триггер срабатывает** → автоматически вызывается `generateNextOrderNumber()`
3. **Генерируется номер заказа** → номер увеличивается на 1
4. **Заполняется акт приема** → все данные из формы переносятся в акт
5. **Акт готов** → можно распечатать или отправить клиенту

## Интеграция с системой SCAutomation

- **Google Форма** → автоматически заполняет лист "Форма"
- **Apps Script** → генерирует номера и заполняет акты
- **Терминал самообслуживания** → клиент может самостоятельно оформить заявку

## Важные моменты

1. **ID таблицы** - обязательно замените в `acceptanceСertificate.js`
2. **Права доступа** - убедитесь, что у скрипта есть права на редактирование таблицы
3. **Триггер** - должен быть настроен правильно для автоматической работы
4. **Структура листов** - должна точно соответствовать описанной выше
5. **Google Форма** - должна быть привязана к правильной таблице

## Решение проблем

### Скрипт не работает:
- Проверьте ID таблицы
- Убедитесь, что триггер настроен
- Проверьте права доступа скрипта

### Данные не заполняются:
- Проверьте названия листов ("Форма", "АктПриёма")
- Убедитесь, что структура столбцов соответствует описанию
- Проверьте, что Google Форма привязана к таблице

### Триггер не срабатывает:
- Проверьте настройки триггера
- Убедитесь, что форма привязана к правильной таблице
- Проверьте логи выполнения в Apps Script

## Мониторинг и логи

Для отслеживания работы системы:
1. **Консоль Apps Script** - проверяйте на наличие ошибок
2. **Логи выполнения** - в Apps Script → Выполнения
3. **История изменений** - в Google Таблицах

## Дальнейшее развитие

Этот модуль можно расширить:
- Добавить уведомления в Telegram о новых заказах
- Добавить автоматическую отправку актов клиентам
- Создать дашборд для мониторинга заказов
